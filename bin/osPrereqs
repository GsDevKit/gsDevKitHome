#! /bin/bash
#=========================================================================
# Copyright (c) 2015 GemTalk Systems, LLC <dhenrich@gemtalksystems.com>.
#=========================================================================

echo "================="
echo "   GsDevKit script: $(basename $0) $*"
echo "================="

set -e # exit on error

usage() {
  cat <<HELP
USAGE: $(basename $0) [-h] -o [ubuntu12.04|ubuntu14.04] [-X]

Install os-specific required packages:
  - 32 bit libraries
  - git 
  - curl
  - unzip
  - ssl
  - PAM

and os-specific optional packages:
  - X11

OPTIONS
  -h 
     display help
  -o 
     select os
  -X 
     if present, X11 client installed
  

EXAMPLES
  $(basename $0) -h
  $(basename $0) -o ubuntu12.04
  $(basename $0) -X -o ubuntu12.04

HELP
}

installUbuntuPackages(){
    sudo apt-get -y update
    sudo apt-get -y install curl
    sudo apt-get -y install git
    sudo apt-get -y install unzip
    sudo apt-get -y install libpam0g:i386
    sudo apt-get -y install libssl1.0.0:i386
    sudo apt-get -y install gcc-multilib libstdc++6:i386
    sudo apt-get -y install gdb
    sudo apt-get -y install libfreetype6:i386
    sudo apt-get -y install pstack
    sudo /bin/su -c "echo 'kernel.yama.ptrace_scope = 0' >>/etc/sysctl.d/10-ptrace.conf"
    if [ "${X11client}x" = "1x" ] ; then
      sudo apt-get -y install libgl1-mesa-dev:i386
      sudo apt-get -y install libxcb-dri2-0:i386
    fi
}

os=""
X11client=""

while getopts "ho:X" OPT ; do
  case "$OPT" in
    h) usage; exit 0 ;;
    o) os="${OPTARG}" ;;
    X) X11client="1";;
    *) usage; exit 1 ;;
  esac
done
shift $(($OPTIND - 1))

case "$os" in
  ubuntu12.04)
    installUbuntuPackages
    sudo ln -f -s /lib/i386-linux-gnu/libpam.so.0 /lib/libpam.so.0
    sudo ln -f -s /usr/lib/i386-lin-gnu/libstdc++.so.6 /usr/lib/i386-linux-gnu/libstdc++.so
  ;;
  ubuntu14.04)
    installUbuntuPackages
    sudo ln -f -s /usr/lib/i386-lin-gnu/libstdc++.so.6 /usr/lib/i386-linux-gnu/libstdc++.so
    ;;
  *) usage; exit 1;;
esac
